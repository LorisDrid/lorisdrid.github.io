{% import "macros.html" as macros %}
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <title>
    {% if page.title %}{{ page.title }} - {{ config.title }}{% else %}{{ config.title }}{% endif %}
  </title>

  <meta name="theme-color" />

  {% if page %}
    {% set page_title = page.title | default(value=config.title) %}
    {% set description = page.description | default(value=page_title) %}
    {% if page.authors | length > 0 %}
      {% set author = page.authors | join(sep=", ") %}
    {% else %}
      {% set author = config.author | default(value=config.title) %}
    {% endif %}
    <meta name="description" content="{{ description }}" />
    <meta name="author" content="{{ author }}" />

    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{ page_title }}" />
    <meta property="og:site_name" content="{{ config.title }}" />
    <meta property="og:description" content="{{ description }}" />
    <meta property="og:url" content="{{ page.permalink }}" />
    {% if page.extra.cover.image %}
      {% set image = page.extra.cover.image %}
    {% elif config.extra.social_image %}
      {% set image = config.extra.social_image %}
    {% endif %}
    {% if image %}
      <meta property="og:image" content="{{ get_url(path=image) }}" />
    {% endif %}
  {% else %}
    {% set description = config.description | default(value="A personal blog") %}
    <meta name="description" content="{{ description }}" />
    <meta name="author" content="{{ config.author | default(value=config.title) }}" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{ config.title }}" />
    <meta property="og:description" content="{{ description }}" />
    <meta property="og:url" content="{{ get_url(path=``) }}" />
    {% if config.extra.social_image %}
      <meta property="og:image" content="{{ get_url(path=config.extra.social_image) }}" />
    {% endif %}
  {% endif %}

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="preload" as="style" href="{{ get_url(path='main.css') }}" />
  <link rel="preload" as="image" href="{{ get_url(path=config.extra.profile.avatar_url) }}" />
  <link rel="preload" as="image" href="{{ get_url(path='icons/theme.svg') }}" />

  <link rel="stylesheet" href="{{ get_url(path='main.css') }}" />
  <link rel="stylesheet" href="{{ get_url(path='custom.css') }}" />

  <style>
    :root {
      --bg: {{ config.extra.style.bg_color | default(value="#f4f4f5") }};
      --bg-dark: {{ config.extra.style.bg_dark_color | default(value="#18181b") }};
      --header: {{ config.extra.style.header_color | default(value="#e4e4e7") }};
      --header-dark: {{ config.extra.style.header_dark_color | default(value="#27272a") }};
    }
  </style>

  {% if page.extra.cover.image %}
    <link rel="preload" as="image" href="{{ get_url(path=page.extra.cover.image) }}" />
  {% endif %}

  {% if page.extra.math | default(value=config.extra.math) %}
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.16/dist/katex.min.css" as="style" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16/dist/katex.min.css" crossorigin="anonymous" />
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16/dist/katex.min.js" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>
    {% include "partials/math.html" %}
  {% endif %}

  {% if page.extra.mermaid | default(value=config.extra.mermaid) %}
    <script type="module" defer>
      if (document.querySelector('.mermaid')) {
        import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs')
          .then(m => m.default.initialize({ startOnLoad: true }));
      }
    </script>
    {% include "partials/mermaid.html" %}
  {% endif %}

  <link rel="icon" href="{{ get_url(path='favicon.ico') }}" />
  <link rel="apple-touch-icon" href="{{ get_url(path='apple-touch-icon.png') }}" />

  {% if config.generate_feed %}
    {% if "atom.xml" in config.feed_filenames %}
      <link rel="alternate" type="application/atom+xml" title="Atom" href="{{ get_url(path='atom.xml') }}" />
    {% endif %}
    {% if "rss.xml" in config.feed_filenames %}
      <link rel="alternate" type="application/rss+xml" title="RSS" href="{{ get_url(path='rss.xml') }}" />
    {% endif %}
  {% endif %}

  <link rel="canonical" href="{{ page.permalink | default(value=get_url(path=``)) }}" />

  {% include "injects/head.html" ignore missing %}
</head>
